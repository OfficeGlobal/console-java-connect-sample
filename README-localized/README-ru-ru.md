---
page_type: sample
products:
- office-outlook
- office-word
- ms-graph
languages:
- java
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph 
  - Microsoft identity platform
  services:
  - Outlook
  - Microsoft identity platform
  platforms:
  - Android
  createdDate: 3/5/2018 10:29:43 AM
---
# Интегрируйте Microsoft Graph API в приложение командной строки Java, используя имя пользователя и пароль

В этом примере показано приложение командной строки, которое вызывает API-интерфейс Microsoft Graph, защищенный Azure AD. Приложение использует [библиотеку аутентификации ScribeJava](https://github.com/scribejava/scribejava) для получения веб-токена JSON (JWT) по протоколу OAuth 2.0. Возвращенный JWT известен как **токен доступа**. Маркер доступа добавляется ко всем запросам в Microsoft Graph API в виде заголовка HTTP. Он аутентифицирует пользователя и получает доступ к сервису.

В этом примере показано, как использовать **ScribeJava** для проверки подлинности пользователей с помощью простых учетных данных (имя пользователя и пароль) на основе текстового интерфейса.

## Быстрое начало работы

Начать с образца легко. Он настроен на запуск из коробки с минимальной настройкой.

### Шаг 1. Регистрация клиента Azure AD

Для работы с этим образцом необходимо клиента Azure Active Directory. Если вы не знаете, какой у вас клиент и как вы его получали, см. статью [что такое клиент Azure AD](http://technet.microsoft.com/library/jj573650.aspx)? [зарегистрироваться в Azure в качестве](http://azure.microsoft.com/documentation/articles/sign-up-organization/)Организации. Эти документы помогут вам начать работу с Azure AD.

### Шаг 2. Загрузите Java (7 и выше) для вашей платформы

Для работы с этим образцом необходимо установить [Java](http://www.oracle.com/technetwork/java/javase/downloads/index.html) и [Gradle](https://gradle.org/).

Образец был построен с использованием плагина Gradle для IntelliJ IDEA IDE. Файл build.gradle проекта настроен так, чтобы вы могли запускать образец из IntelliJ. Конфигурация run build позволяет запустить или отладить образец.

### Шаг 3. Скачать образец приложения и модулей

Затем клонируйте образец репозитория и установите зависимости проекта.

Из вашей оболочки или командной строки:

* `$ git@github.com:microsoftgraph/console-java-connect-sample.git`
* `$ cd console-java-connect-sample`

### Шаг 4. Зарегистрировать консольное приложение Java Connect

1. Войдите на [Портал Azure — Регистрация приложений](https://go.microsoft.com/fwlink/?linkid=2083908) с помощью личной, рабочей или учебной учетной записи.

2. Выберите **Новая регистрация**.

3. В разделе **Имя** введите понятное имя приложения, которое будет отображаться для пользователей приложения

1. В разделе **Поддерживаемые типы учетных записей** выберите **Учетные записи в любом каталоге организации и личные учетные записи Майкрософт (например, Skype, Xbox, Outlook.com)**  

1. Выберите **Зарегистрировать**, чтобы создать приложение. 
	
   На странице приложения "Обзор" приводятся свойства приложения.

4. Скопируйте **идентификатор приложения (клиента)**. Это уникальный идентификатор приложения. 

1. В списке страниц приложения выберите **Проверка подлинности**.

1. В разделе **URI перенаправления** в разделе **предлагаемые URI перенаправления для общедоступных клиентов (мобильный, Настольный)** установите флажок **https://login.microsoftonline.com/common/oauth2/nativeclient**

8. Выберите команду **Сохранить**.

> **Примечание.** Конечная точка авторизации Azure Active Directory v 2.0 использует [добавочных и динамических разрешений](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-compare#incremental-and-dynamic-consent) это означает, что при регистрации приложения не нужно устанавливать разрешения (теперь называемые **областями **). Области запрашиваются вашим приложением во время выполнения.

### Шаг 5. Настройте ваше приложение, используя Constants.java

Используя ваш любимый редактор кода, откройте **..\\console-java-connect-sample\\src\\main\\java\\com\\microsoft\\graphsample\\connect\\Constants.java**. Вставьте Идентификатор приложения из буфера обмена в Constants.java, строка 11, чтобы заменить `ENTER_YOUR_CLIENT_ID`.

```java
public class Constants {

    public final static String CLIENT_ID = "ENTER_YOUR_CLIENT_ID";

//...
}
```

### Шаг 6. Установить Gradle

Если у вас не установлена система сборки Gradle, [установите Gradle](https://docs.gradle.org/4.6/userguide/installation.html).

### Шаг 7. Добавьте обёртку Gradle в проект

Из вашей оболочки или командной строки в корне проекта:

```Shell
gradle wrapper
```

### Шаг 8. Сборка и запуск примера

Из вашей оболочки или командной строки в корне проекта:

```Shell
gradle run
```

Это запустит образец.

### Запуск примера

Интерфейс командной строки открывает окно браузера в конечной точке авторизации Azure Active Directory. Введите ваше имя пользователя и пароль для аутентификации. Когда вы аутентифицируетесь, вы попадаете в окно авторизации для примера приложения. Просмотрите и примите области, запрошенные образцом приложения. Нажмите кнопку Ok в окне авторизации. Браузер переходит на `https://login.microsoftonline.com`. Скопируйте полный URL-адрес перенаправления и вставьте его в текстовый редактор. Он должен выглядеть следующим образом:

```http
https://login.microsoftonline.com/common/oauth2/nativeclient?code={IAQABAAIAAABHh4kmS_aKT5XrjzxRAtHz5S...p7OoAFPmGPqIq-1_bMCAA}&session_state=dd64ce71-4424-494b-8818-be9a99ca0798
```

> **Примечание.** Пример с URL-адресом усечен для ясности. в пример были добавлены `{` и `}`, в котором можно разделить код авторизации.

Код авторизации начинается после `?code=` и заканчивается до `&session_state`.

Скопируйте код авторизации в системный буфер обмена и вставьте его в консоль в разделе `И вставьте код авторизации здесь`.

Вам предлагается:

```Shell
Hello, {your name}. Would you like to send an email to yourself or someone else?
Enter the address to which you'd like to send a message. If you enter nothing, the message will go to your address
```

После того как вы введете адрес электронной почты или оставите приглашение пустым, вам будет отправлено электронное письмо или адрес, который вы вводите в консоли.

Вы можете отправить сообщение электронной почты с другими адресами, выполнив запрос в ответ на запрос "y", `хотите отправить другое сообщение? Напечатайте 'y' для да и любой другой ключ, чтобы выйти.`
